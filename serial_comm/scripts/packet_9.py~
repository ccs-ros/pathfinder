from ctypes import *
from packet_class import *
from serial_comm.msg import pkt_9_msg


class Packet_9_Type(Structure):
	_pack_ = 1
	_fields_ = [("H1",c_ubyte),("H2",c_ubyte),("H3",c_ubyte),("counter",c_ushort),("time",c_ushort),("acceleration_x",c_short),("acceleration_y",c_short),("acceleration_z",c_short),("rate_p",c_short),("rate_q",c_short),("rate_r",c_short),("A2D_1",c_short),("A2D_2",c_short),("A2D_3",c_short),("A2D_4",c_short),("A2D_5",c_short),("A2D_6",c_short),("A2D_7",c_short),("A2D_8",c_short),("laser_1",c_ushort),("laser_2",c_ushort),("speed_controller_1",c_short),("speed_controller_2",c_short),("speed_controller_3",c_short),("speed_controller_4",c_short),("switches",c_ubyte),("voltage",c_ubyte),("status",c_ubyte),("reserved",c_ubyte*13),("checksum",c_ubyte)]

class Packet_9_Buff(Union):
	_fields_ = [("buffer",c_ubyte*64),("fields",Packet_9_Type)]

class Packet_9(Packet_Class):

	def __init__(self):
		self.packet = Packet_9_Buff()
		self.initialize_packet(9)
		self.msg = pkt_9_msg()
		self.msg_class = pkt_9_msg
		self.rate_Hz = 50

	def unpack_buffer2msg(self):
		self.msg.counter            = self.packet.fields.counter
		self.msg.time               = self.packet.fields.time
		self.msg.acceleration_x     = self.packet.fields.acceleration_x
		self.msg.acceleration_y     = self.packet.fields.acceleration_y
		self.msg.acceleration_z     = self.packet.fields.acceleration_z
		self.msg.rate_p             = self.packet.fields.rate_p
		self.msg.rate_q             = self.packet.fields.rate_q
		self.msg.rate_r             = self.packet.fields.rate_r
		self.msg.A2D_1              = self.packet.fields.A2D_1
		self.msg.A2D_2              = self.packet.fields.A2D_2
		self.msg.A2D_3              = self.packet.fields.A2D_3
		self.msg.A2D_4              = self.packet.fields.A2D_4
		self.msg.A2D_5              = self.packet.fields.A2D_5
		self.msg.A2D_6              = self.packet.fields.A2D_6
		self.msg.A2D_7              = self.packet.fields.A2D_7
		self.msg.A2D_8              = self.packet.fields.A2D_8
		self.msg.laser_1            = self.packet.fields.laser_1
		self.msg.laser_2            = self.packet.fields.laser_2
		self.msg.speed_controller_1 = self.packet.fields.speed_controller_1
		self.msg.speed_controller_2 = self.packet.fields.speed_controller_2
		self.msg.speed_controller_3 = self.packet.fields.speed_controller_3
		self.msg.speed_controller_4 = self.packet.fields.speed_controller_4
		self.msg.switches           = self.packet.fields.switches
		self.msg.voltage            = self.packet.fields.voltage
		self.msg.status             = self.packet.fields.status

	#***************************************************************************
	#* method pack_msg2buffer
	#*
	#* Description: copies msg fields into packet structure,
	#*              and assigns a computed checksum to the last byte
	#***************************************************************************
	def pack_msg2buffer(self, in_msg):
#		self.packet.fields.counter            = in_msg.counter
		self.packet.fields.time               = in_msg.time
		self.packet.fields.acceleration_x     = in_msg.acceleration_x
		self.packet.fields.acceleration_y     = in_msg.acceleration_y
		self.packet.fields.acceleration_z     = in_msg.acceleration_z
		self.packet.fields.rate_p             = in_msg.rate_p
		self.packet.fields.rate_q             = in_msg.rate_q
		self.packet.fields.rate_r             = in_msg.rate_r
		self.packet.fields.A2D_1              = in_msg.A2D_1
		self.packet.fields.A2D_2              = in_msg.A2D_2
		self.packet.fields.A2D_3              = in_msg.A2D_3
		self.packet.fields.A2D_4              = in_msg.A2D_4
		self.packet.fields.A2D_5              = in_msg.A2D_5
		self.packet.fields.A2D_6              = in_msg.A2D_6
		self.packet.fields.A2D_7              = in_msg.A2D_7
		self.packet.fields.A2D_8              = in_msg.A2D_8
		self.packet.fields.laser_1            = in_msg.laser_1
		self.packet.fields.laser_2            = in_msg.laser_2
		self.packet.fields.speed_controller_1 = in_msg.speed_controller_1
		self.packet.fields.speed_controller_2 = in_msg.speed_controller_2
		self.packet.fields.speed_controller_3 = in_msg.speed_controller_3
		self.packet.fields.speed_controller_4 = in_msg.speed_controller_4
		self.packet.fields.switches           = in_msg.switches
		self.packet.fields.voltage            = in_msg.voltage
		self.packet.fields.status             = in_msg.status
		self.packet.fields.checksum           = self.compute_checksum()

